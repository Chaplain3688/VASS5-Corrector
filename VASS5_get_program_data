import os
import pandas as pd
import VASS5_patterns as vassp
import VASS5_main as vassm

robotsdata_filename_path = os.path.join(vassm.input_path, "robots_data.xlsx")

def get_program_main_data(lines, robots):
    program_data = {
        "Program Name": None,
        "Comment": None,
        "File Name": None
    }

    for line in lines:
        prog_name_match = vassp.program_name_pattern.match(line)
        if prog_name_match:
            program_data["Program Name"] = prog_name_match.group(1).strip()
            continue

        comment_match = vassp.program_comment_pattern.match(line)
        if comment_match:
            program_data["Comment"] = comment_match.group(1).strip()
            continue

        file_name_match = vassp.program_filename_pattern.match(line)
        if file_name_match:
            program_data["File Name"] = file_name_match.group(1).strip()
            continue

    # Associate program data with the correct robot
    for robot in robots:
        if robot["Saved Path"] in os.path.dirname(file_name):
            if "Programs" not in robot:
                robot["Programs"] = {}
            robot["Programs"][program_data["Program Name"]] = program_data
            break
